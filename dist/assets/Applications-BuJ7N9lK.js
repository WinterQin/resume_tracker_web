import{g as r,h as T,s as pe,j as I,o as p,k as l,n as w,B as ce,w as o,r as i,C as me,c as b,p as m,m as u,A as fe,v as f,y as q,z as _e,x as N,F as ve,D as ye,G as ge}from"./vendor-C-QY2w59.js";import{a as x,f as be}from"./date-Pr8jrns1.js";import{A as ke}from"./AppHeader-Br-H0n0y.js";import{_ as Ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-VRQGSizK.js";const Ce={class:"applications-container"},we={class:"header"},xe={key:1},Se={class:"pagination-container"},ze={class:"dialog-footer"},Ue={class:"dialog-footer"},Ae={__name:"Applications",setup(De){const B=r([]),j=r(!1),v=r(!1),k=r(!1),y=r(!1),S=r(!1),E=r(null),z=r(null),U=r("暂无数据"),V=r(1),A=r(10),$=r(0),n=T({company:"",position:"",event_link:"",location:"",salary:"",contact_info:"",notes:""}),C=T({status:""}),M={company:[{required:!0,message:"请输入公司名称",trigger:"blur"}],position:[{required:!0,message:"请输入职位名称",trigger:"blur"}],event_link:[{required:!0,message:"请输入面试链接",trigger:"blur"}]},P=[{label:"已投递",value:"submitted"},{label:"笔试中",value:"written"},{label:"面试中",value:"interview"},{label:"已录用",value:"accepted"},{label:"已拒绝",value:"rejected"}],R=a=>({submitted:"primary",written:"warning",interview:"",accepted:"success",rejected:"danger"})[a]||"info",G=a=>({submitted:"已投递",written:"笔试中",interview:"面试中",accepted:"已录用",rejected:"已拒绝"})[a]||a,H=a=>a==="interview"?{backgroundColor:"#A020F0",color:"#ffffff"}:{},g=async()=>{try{j.value=!0,U.value="数据加载中...";const a=await x.getApplications({page:V.value,pageSize:A.value});if(!a||!a.applications){U.value="暂无申请记录",B.value=[];return}B.value=a.applications.map(e=>({id:e.ID,company:e.company,position:e.position,status:e.status,apply_date:e.apply_date,event_link:e.event_link,Notes:e.notes,Salary:e.salary,Location:e.location,ContactInfo:e.contact_info})),$.value=a.total}catch(a){console.error("获取申请列表失败:",a),U.value="数据加载失败，请刷新重试",m.error("获取申请列表失败："+(a.message||"未知错误"))}finally{j.value=!1}},O=()=>{S.value=!1,n.company="",n.position="",n.event_link="",n.location="",n.salary="",n.contact_info="",n.notes="",v.value=!0},J=a=>{S.value=!0,z.value=a,n.company=a.company,n.position=a.position,n.event_link=a.event_link,n.location=a.location,n.salary=a.salary,n.contact_info=a.contact_info,n.notes=a.notes,v.value=!0},K=async a=>{var e,s;try{await ge.confirm("确定要删除这条申请记录吗？","提示",{type:"warning"}),await x.deleteApplication(a.id),m.success("删除成功"),g()}catch(d){d!=="cancel"&&(console.error("删除失败:",d),m.error(((s=(e=d.response)==null?void 0:e.data)==null?void 0:s.error)||"删除失败"))}},Q=a=>{z.value=a,C.status=a.status,k.value=!0},W=async()=>{var a,e;if(E.value)try{await E.value.validate(),y.value=!0;const s={company:n.company,position:n.position,event_link:n.event_link,location:n.location||"无",salary:n.salary||"无",contact_info:n.contact_info||"无",notes:n.notes||"无"};S.value?(await x.updateApplication(z.value.id,s),m.success("更新成功")):(await x.createApplication(s),m.success("创建成功")),v.value=!1,g()}catch(s){console.error("操作失败:",s),m.error(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.error)||"操作失败")}finally{y.value=!1}},X=async()=>{var a,e;try{y.value=!0,await x.updateStatus({id:z.value.id,status:C.status}),m.success("状态更新成功"),k.value=!1,g()}catch(s){console.error("状态更新失败:",s),m.error(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.error)||"状态更新失败")}finally{y.value=!1}},Y=a=>{V.value=a,g()},Z=a=>{A.value=a,V.value=1,g()};return pe(()=>{g()}),(a,e)=>{const s=i("el-button"),d=i("el-table-column"),ee=i("el-tag"),te=i("el-icon"),le=i("el-link"),D=i("el-descriptions-item"),ae=i("el-descriptions"),oe=i("el-button-group"),ne=i("el-table"),se=i("el-pagination"),_=i("el-input"),c=i("el-form-item"),ie=i("el-divider"),h=i("el-form"),F=i("el-dialog"),ue=i("el-option"),re=i("el-select"),de=me("loading");return p(),I("div",Ce,[l(ke),w("div",we,[e[15]||(e[15]=w("h2",null,"申请列表",-1)),l(s,{type:"primary",onClick:O},{default:o(()=>e[14]||(e[14]=[u("新建申请")])),_:1})]),ce((p(),b(ne,{data:B.value,style:{width:"100%"},"empty-text":U.value},{default:o(()=>[l(d,{prop:"company",label:"公司","min-width":"120"}),l(d,{prop:"position",label:"职位","min-width":"120"}),l(d,{prop:"status",label:"状态",width:"100"},{default:o(({row:t})=>[l(ee,{type:R(t.status),style:fe(H(t.status))},{default:o(()=>[u(f(G(t.status)),1)]),_:2},1032,["type","style"])]),_:1}),l(d,{prop:"event_link",label:"面试链接","min-width":"150"},{default:o(({row:t})=>[t.event_link&&t.event_link!=="无"?(p(),b(le,{key:0,type:"primary",href:t.event_link,target:"_blank",underline:!1},{default:o(()=>[l(te,null,{default:o(()=>[l(q(_e))]),_:1}),u(" "+f(t.event_link),1)]),_:2},1032,["href"])):(p(),I("span",xe,f(t.event_link),1))]),_:1}),l(d,{prop:"apply_date",label:"申请时间",width:"180"},{default:o(({row:t})=>[u(f(q(be)(t.apply_date)),1)]),_:1}),l(d,{type:"expand",fixed:"right",width:"50"},{default:o(t=>[l(ae,{class:"expanded-info",column:1,border:""},{default:o(()=>[t.row.Location?(p(),b(D,{key:0,label:"工作地点"},{default:o(()=>[u(f(t.row.Location),1)]),_:2},1024)):N("",!0),t.row.Salary?(p(),b(D,{key:1,label:"期望薪资"},{default:o(()=>[u(f(t.row.Salary),1)]),_:2},1024)):N("",!0),t.row.ContactInfo?(p(),b(D,{key:2,label:"联系信息"},{default:o(()=>[u(f(t.row.ContactInfo),1)]),_:2},1024)):N("",!0),t.row.Notes?(p(),b(D,{key:3,label:"备注"},{default:o(()=>[u(f(t.row.Notes),1)]),_:2},1024)):N("",!0)]),_:2},1024)]),_:1}),l(d,{label:"操作",width:"200",fixed:"right"},{default:o(({row:t})=>[l(oe,null,{default:o(()=>[l(s,{size:"small",onClick:L=>J(t)},{default:o(()=>e[16]||(e[16]=[u("编辑")])),_:2},1032,["onClick"]),l(s,{size:"small",type:"danger",onClick:L=>K(t)},{default:o(()=>e[17]||(e[17]=[u("删除")])),_:2},1032,["onClick"]),l(s,{size:"small",type:"success",onClick:L=>Q(t)},{default:o(()=>e[18]||(e[18]=[u("更新状态")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","empty-text"])),[[de,j.value]]),w("div",Se,[l(se,{"current-page":V.value,"onUpdate:currentPage":e[0]||(e[0]=t=>V.value=t),"page-size":A.value,"onUpdate:pageSize":e[1]||(e[1]=t=>A.value=t),"page-sizes":[10,15,20],total:$.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Z,onCurrentChange:Y},null,8,["current-page","page-size","total"])]),l(F,{modelValue:v.value,"onUpdate:modelValue":e[10]||(e[10]=t=>v.value=t),title:S.value?"编辑申请":"新建申请",width:"600px"},{footer:o(()=>[w("span",ze,[l(s,{onClick:e[9]||(e[9]=t=>v.value=!1)},{default:o(()=>e[20]||(e[20]=[u("取消")])),_:1}),l(s,{type:"primary",onClick:W,loading:y.value},{default:o(()=>e[21]||(e[21]=[u(" 确定 ")])),_:1},8,["loading"])])]),default:o(()=>[l(h,{model:n,rules:M,ref_key:"formRef",ref:E,"label-width":"100px"},{default:o(()=>[l(c,{label:"公司",prop:"company"},{default:o(()=>[l(_,{modelValue:n.company,"onUpdate:modelValue":e[2]||(e[2]=t=>n.company=t),placeholder:"请输入公司名称"},null,8,["modelValue"])]),_:1}),l(c,{label:"职位",prop:"position"},{default:o(()=>[l(_,{modelValue:n.position,"onUpdate:modelValue":e[3]||(e[3]=t=>n.position=t),placeholder:"请输入职位名称"},null,8,["modelValue"])]),_:1}),l(c,{label:"面试链接",prop:"event_link"},{default:o(()=>[l(_,{modelValue:n.event_link,"onUpdate:modelValue":e[4]||(e[4]=t=>n.event_link=t),placeholder:"请输入面试链接"},null,8,["modelValue"])]),_:1}),l(ie,null,{default:o(()=>e[19]||(e[19]=[u("可选信息")])),_:1}),l(c,{label:"工作地点"},{default:o(()=>[l(_,{modelValue:n.location,"onUpdate:modelValue":e[5]||(e[5]=t=>n.location=t),placeholder:"请输入工作地点"},null,8,["modelValue"])]),_:1}),l(c,{label:"期望薪资"},{default:o(()=>[l(_,{modelValue:n.salary,"onUpdate:modelValue":e[6]||(e[6]=t=>n.salary=t),placeholder:"请输入期望薪资"},null,8,["modelValue"])]),_:1}),l(c,{label:"联系信息"},{default:o(()=>[l(_,{modelValue:n.contact_info,"onUpdate:modelValue":e[7]||(e[7]=t=>n.contact_info=t),placeholder:"请输入联系信息"},null,8,["modelValue"])]),_:1}),l(c,{label:"备注"},{default:o(()=>[l(_,{modelValue:n.notes,"onUpdate:modelValue":e[8]||(e[8]=t=>n.notes=t),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(F,{modelValue:k.value,"onUpdate:modelValue":e[13]||(e[13]=t=>k.value=t),title:"更新状态",width:"400px"},{footer:o(()=>[w("span",Ue,[l(s,{onClick:e[12]||(e[12]=t=>k.value=!1)},{default:o(()=>e[22]||(e[22]=[u("取消")])),_:1}),l(s,{type:"primary",onClick:X,loading:y.value},{default:o(()=>e[23]||(e[23]=[u(" 确定 ")])),_:1},8,["loading"])])]),default:o(()=>[l(h,{model:C,"label-width":"80px"},{default:o(()=>[l(c,{label:"状态"},{default:o(()=>[l(re,{modelValue:C.status,"onUpdate:modelValue":e[11]||(e[11]=t=>C.status=t),placeholder:"请选择状态"},{default:o(()=>[(p(),I(ve,null,ye(P,t=>l(ue,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},$e=Ve(Ae,[["__scopeId","data-v-e7b2cdf7"]]);export{$e as default};
